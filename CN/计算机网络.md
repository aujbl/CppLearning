# 第一章 概论

1. 构成

    1. 节点：主机及其运行的应用程序、路由器、交换机

    2. 边：通信链路（接入网链路、主干链路）

    3. 协议：控制发送、接收消息

2. 网络结构

    1. 网络边缘：主机、应用程序

        1. 端系统（主机）

        2. 客户/服务器模式

        3. 对等peer-peer模式

    2. 网络核心：互连的路由器、网络的网络

        1. 电路交换：端到端的资源分配、网络资源被分成片（统计多路复用（FDM、TDM））

        2. 分组交换：以分组为单位，存储-转发方式；资源共享，按需使用

        3. 关键功能：路由、转发（数据报网络（类似问路）、虚电路网络（带标签，保持路径））

    3. 接入网、物理媒体：有线或无线通信链路

        1. 住宅接入（modem）网络、企业接入网络、无线接入网络

        2. 物理媒体：同轴电缆、光纤、无线链路（地面微波、LAN、wide-aera、卫星）

3. 分组延时、丢失和吞吐量

    1. 分组延时：节点处理延时、排队延时、传输延时、传播延时

        1. 传输时延：发送整个分组所需时间，与分组长度和链路传输速率相关

        2. 传播时延：发送一个比特所需时间，与链路长度有关

    2. 分组丢失：队列缓冲区容量有限，队列满时分组丢失、丢失的分组可能由上一节点或源端重传，也可能不重传

    3. 瞬间吞吐量/平均吞吐量

4. 协议层次及服务模型

    1. 服务和服务访问点(SAP)

    2. 服务类型：面向连接和无连接

    3. 服务和协议：本层协议靠下层提供的服务来实现，本层实体通过协议为上层提供服务

    4. 数据单元

5. Internet协议栈

    1. 应用层：FTP/SMTP/HTTP/DNS...（报文message）

    2. 传输层：TCP/UDP（报文段segment）

    3. 网络层：IP/路由协议（分组packet/datagram）

    4. 链路层：PPP/802.11/Ethernet（帧frame）

    5. 物理层：传输bit（位bit） 

# 第二章 应用层

1. 体系结构

    1. 客户-服务器（C/S）模式

    2. 对等模式（P2P：peer To Peer）

    3. 混合体

2. 分布式进程通信

    1. 对进程进行编址：IP + Port

    2. TCP Socket：一个整数本地标示，代表一个四元组（源IP/源端口/目标IP/目标端口）

    3. UDP Socket：本地IP + 本地Port，发送报文时要指定对方的IP和UDP Port

3. Web Http

    1. URL格式：协议名 + 用户名：口令 + 主机名 + 路径名 + 端口

    2. HTTP概况

        1. 使用TCP，默认端口80

        2. HTTP是无状态的，服务器不维护关于客户的信息

        3. 非持久HTTP/持久HTTP

            1. HTTP1.0使用非持久连接，HTTP1.1默认使用持久连接

            2. 持久HTTP（非流水式：一次只有一个请求，前一个响应后发出新请求 / 流水式：同时请求）

        4. HTTP请求报文

            1. 请求行（GET / POST / HEAD） + PUT/DELETE(HTTP1.1)

            2. + 首部行（Host / User-agent / Connection / Accept-language）

            3. + 实体部分

        5. HTTP响应报文

            1. 状态行（协议版本、状态码、相应状态信息）

                1. 状态码：200(OK) / 301(Moved Permanently) / 400(Bad Request) / 404(Not Foune) / 505(HTTP Version Not Supported)

            2. 首部行

            3. 数据

        6. 使用Cookies维护用户-服务器状态

        7. Web缓存：不访问原始服务器，满足客户的请求

        8. 条件GET方法：如果缓存器中的对象是最新的（请求时 + 最后修改时间），则不发送对象

4. FTP：文件传输协议

    1. 控制连接：带外传送

    2. 使用TCP传输协议

    3. 服务器维护用户状态信息

5. Email

    1. SMTP(push)

        1. 3个阶段：握手、传输报文、关闭

        2. 持久连接

        3. 报文格式：首部行(To: / From: / Subject:) + 主体（ASCII字符）

        4. MIME：多媒体邮件拓展

    2. POP3（邮局访问协议）(pull)

        1. 用户确认阶段

        2. 事务处理阶段

    3. IMAP

6. DNS

    1. 目的：实现主机名-IP地址的转换

    2. 主要思路：分层的、分布式的、运行在UDP的53号端口上、以应用层协议实现

    3. RR格式：Domain_name、TTL、Class、Value、Type

    4. 递归查询、迭代查询

    5. DNS协议：查询和相应报文的报文格式相同，通过标志位区分

7. P2P应用

    1. 问题：如何定位所需资源、如何处理peer的加入与离开

    2. 集中式目录：单点故障、性能瓶颈、侵犯版权

    3. 查询泛洪：Gnutella(ping-pong)

    4. KaZaA：组长跟踪所有组员，与其他组长联系；使用hash值查询

    5. BitTorrent
        
        1. tracker跟踪参与节点
        
        2. Torrent节点的组，之间交换文件块

        3. 稀缺优先、有限疏通

    6. DHT(Distributed Hash Table)结构化P2P

8. CDN(Content Distribution Networks)

    1. 多媒体流化服务(DASH: Dynamic Adaptive Streaming over HTTP)

9. TCP套接字编程

    1. 服务器：创建、捆绑、等待连接

    2. 客户端：创建（隐式捆绑）、连接

    3. 服务器接受连接 -> 建立TCP连接


10. UDP套接字编程

# 第三章 传输层

1. 网络层服务：主机之间的逻辑通信；传输层服务：进程之间的逻辑通信

2. 在发送方主机多路复用，在接收方主机多路解复用

3. 面向连接的多路复用可以解复用到不同线程

4. 无连接传输UDP

    1. “尽力而为”的服务，可能丢失和乱序

    2. 无连接：无握手，每个报文段独立处理

    3. 适用于流媒体、DNS、SNMP等（丢失不敏感，速率敏感）

    4. 用UDP校验和检测报文段的差错

5. 可靠数据传输（rdt）原理

    1. （rdt1.0）在可靠信道上进行可靠数据传输，使用有限状态机（FSM）描述发送方，接收方

    2. （rdt2.0）采用差错控制编码进行差错检测
    
        1. 确认(ACK)：接收方显式地告诉发送方已正确接收；否定确认(NAK)：接收方通知发送方发生差错

    3. （rdt2.1）使用序号解决ACK、NAK传输出错问题（停止等待协议）

    4. （rdt2.2）用先前正确接收的分组的ACk代替当前错误分组的NAK

    5. （rdt3.0）超时重传机制：解决分组丢失问题（分组丢失可能形成死锁）

    6. 流水线：允许发送方在未得到接收方确认的情况下一次发送多个分组（提高链路利用率）

        1. 需要增加序号的范围

        2. 在发送方、接收方需要缓冲区（发送：可能需要重传、接收：需要排序交付）

        3. 缓冲区大小 = 1：停止等待协议； > 1:流水线协议

    7. 流水线协议：回退N步(GBN)、选择重传(SR)

        1. 滑动窗口协议

            1. 发送窗口

                1. 相对移动：分组不动，可缓冲范围移动

                2. 发送分组时移动前沿，前沿移动不能超过发送缓冲区

                3. 接收到确认移动后沿，后沿不能超过前沿
        
            2. 接收窗口

                1. 尺寸 = 1（GBN：发送方窗口 > 1）：只能顺序接收，发送连续收到的最大的分组确认（累计确认）

                2. 尺寸 > 1（SR：发送方窗口 > 1）：可以乱序接收，发送收到分组的确认（独立确认）

                3. 乱序到来，缓冲但不交付、不滑动

        2. 总结

            1. GBN

                1. 发送端在流水线中最多有N个未确认分组

                2. 接收端累计确认，发现gap时，不确认新到来的分组

                3. 发送端只有一个最老的未确认分组的定时器，定时器到时重传所有未确认分组

            2. SR

                1. 发送端在流水线中最多有N个未确认分组

                2. 接收端单独确认

                3. 发送方为每个未确认分组保持一个定时器，超时只重传未确认分组

            3. 对比

                ||GBN|SR|
                |:-----:|:-----:|:-----:|
                |优点|简单，所需资源少|出错重传代价小|
                |缺点|回退N代价大|接收方所需资源多|
                |适用范围|出错率低|链路容量大|

6. 面向连接的传输：TCP

    1. 概述

        1. 点对点

        2. 全双工

        3. 可靠的、按顺序的字节流

        4. 管道化（流水线）

        5. 面向连接

        6. 发送和接收缓存

        7. 有流量控制

    2. TCP报文段

        1. 序号：报文段首字节在字节流中的编号
        
        2. 确认号：期望收到的下一字节的序号

        3. 往返延时RTT和超时

            1. 太早超时会引起不必要的重传

            2. 超时时间太长时对报文段丢失反应慢
        
    3. 快速重传：在定时器到时前重传

        1. 超时周期太长

        2. 通过重复的ACK来检测报文段的丢失

        3. 收到三个冗余的ACK，重传最小序号的段

    4. TCP流量控制

        1. 接收方控制发送方，减缓发送速度，以免接收方缓冲区溢出

        2. 接收方在rwnd字段告知空闲buffer大小

    5. TCP连接管理

        1. 同意建立连接、同意连接参数

        2. 2次握手的失败场景

            1. 半连接：只在服务器维护了连接

            2. 老的数据被当成新的数据接受了

        3. 3次握手解决半连接和接收老数据的问题

        4. 变化的初始序号解决网络滞留引起的问题

        5. 关闭连接：对称释放

7. 拥塞控制原理

    1. 表现：分组丢失、分组经历延时长

    2. 原因：带宽限制、有限的缓冲等；拥塞时超时重传可能导致网络急速瘫痪

    3. 理想化：掌握丢失信息

    4. 拥塞控制方法

        1. 端到端的拥塞控制：端系统根据延迟和丢失事件推断是否拥塞

        2. 网络辅助的拥塞控制：路由器提供反馈信息

    5. ATM ABR(available bit rate)拥塞控制（网络辅助）

        1. “弹性服务”

        2. RM(资源管理)单元：NI轻微拥塞、CI拥塞指示

8. TCP拥塞控制

    1. 端到端的拥塞控制机制：路由器不提供有关拥塞的反馈信息；端系统根据自身信息判断

    2. 主要问题：如何检测拥塞、控制策略

        1. 检测拥塞：某个段超时 -> 拥塞；3次重复ACK -> 轻微拥塞

        2. 控制速率：维持一个拥塞窗口值CongWin，限制已发送但未确认的数据量，控制注入速率

    3. 策略概述
    
        1. 慢启动阶段（SS）：连接开始时，指数性增加发送速率，直到发生丢失事件（初始慢、加速快）
        
        2. AIMD（乘性减、线性增）拥塞避免阶段（CA）
        
            1. （拥塞）发生丢失事件后，CongWin降为1，CongWin / 2作为阈值，下次只倍增到CongWin / 2，然后线性增（每次 + 1）
            
            2. （轻微拥塞：3次ACk）Threshold = CongWin / 2，CongWin = Threshold + 3，直接开始线性增，跳过慢启动
        
        3. 超时事件后的保守策略

# 第四章

1. 


2. 路由器组成

    1. 输入端口

        1. 路由：运行路由选择算法

        2. 转发：根据路由表进行分组的转发
            
            1. 基于目标的转发
            
            2. 最长前缀匹配

        3. 输入端口缓存：交换速率小于输入端口的汇聚速率，排队延迟和输入缓存溢出会造成丢失

        4. 交换

            1. 通过内存交换

            2. 通过总线交换

            3. 通过互联网络(crossbar)交换

    4. 输出端口

        1. 由调度规则选择排队的数据进行传输

        2. 数据从交换机到达的速率 > 传输速率

        3. 排队延时和溢出会导致丢弃数据报

        4. 调度机制

            1. FIFO

            2. 优先权

            3. 其他

3. IP协议

    1. 网络层：路由协议、IP协议、ICMP协议

    2. IP分片和重组：网络链路有MTU，大的IP数据报在网络上被分片

    3. IP数据报：20字节头部 + 可选部分，偏移量1 = 8B

    4. IP地址：32位标示，对主机或路由器的接口编址

    5. 接口：主机、路由器、物理链路的连接处

    6. 一个地址和一个接口相关联

    7. 子网

        1. 前缀一样

        2. 无需路由器介入，一跳可达

    8. IP地址分类

        |类别|||网络号|主机号|专用地址|子网掩码|
        |:---:|:---:|:---:|:---:|:---:|:---:|:---:|
        |A|0    |单播|||10.0.0.0 - 10.255.255.255|255.0.0.0|
        |B|10   |单播|||172.16.0.0 - 172.31.255.255|255.255.0.0|
        |C|110  |单播|||192.168.0.0 - 192.168.255.255|255.255.255.0|
        |D|1110 |广播||||
        |E|1111 0|预留||||


        1. 子网部分：全为0 -- 本网络

        2. 主机部分：全为0 -- 本主机

        3. 主机部分：全为1 -- 广播地址，本网络的所有主机

        4. CIDR：无类域间路由(a.b.c.d/x)，其中x是子网号的长度

        5. 转发表:找到则按表项转发，否则默认转发

        |目标子网|子网掩码|下一跳|接口|
        |:---:|:---:|:---:|:---:|
        |202.38.73.0|255.255.255.192|IPx|Lan1|
        |202.38.64.0|255.255.255.192|IPy|Lan2|
        |...||||
        |Default|-|IPz|Lan0|

        6. DHCP：从服务器动态获得IP地址

        7. 层次编址：允许路由信息有效广播

        8. ICANN：分配地址、管理DNS、分配域名、解决冲突

    9. NAT：Network Address Translation

        1. 本地网络只有一个有效的IP地址

        2. NAT穿透：静态配置NAT、UPnPIGD协议、中继

    10. IPv6

        1. 数据报格式：固定40字节头部、不允许分片

        2. 隧道：IPv6借助IPv4传输

# 第五章

1. 路由选择算法：为所有路由器找到并使用汇集树

    1. 最优化原则：汇集树

    2. 原则：正确性、简单性、健壮性、稳定性、公平性、最优性

    3. 算法分类：全局、分布式；静态、动态

2. link state

    1. LS路由的基本工作过程

        1. 发现相邻节点，获知对方的网络地址

        2. 测量到相邻节点的代价

        3. 组装LS分组，描述代价情况

        4. 扩散分组

        5. 通过Dijkstra算法（每个节点到其他节点的最短路径）找出最短路径

3. 距离矢量(DV)路由选择

    1. 一种动态路由算法（Bellman-Ford方程（动态规划））

    2. 基本思想：各个路由器维护一张路由表，各路由器与相邻路由交换路由表，然后更新路由表

    3. 特点：好消息传的快，坏消息传的慢

    4. 水平分裂算法：解决无穷计算问题

    5. 异步、分布式、迭代

4.  ||消息复杂度|收敛时间|健壮性|
    |:---:|:---:|:---:|:---:|
    |LS||√|√|
    |DV|√|||

5. 自治系统内部的路由选择

    1. RIP(Routing Information Protocol)

    2. OSPF(Open Shortest Path First)

6. ISP之间的路由选择

    1. 层次路由

        1. 一个平面的路由：所有路由地位一样，所有路由需要知道其他路由的路径，规模巨大时，存储、传输和计算代价大，难以管理

        2. 层次路由：将互联网分成多个AS(autonomous systems)，AS内部运行相同的路由协议；AS间运行AS间路由协议

        3. 优点：解决了规模问题、解决了管理问题

7. 互联网间AS间路由协议：BGP(Border Gateway Protocol)

    1. eBGP：从相邻的As获取子网可达信息

    2. iBGP：将获得的子网信息传遍AS内部的所有路由器

    3. 基于距离矢量算法

    4. BGP基础

        1. BGP会话：2个BGP路由器在一个半永久的TCP连接上交换BGP报文

        2. BGP通告

            1. 基于策略决定是否向邻居通告路由信息

            2. 重要属性：AS-PATH、NEXT-HOP

        3. BGP报文：OPEN、UPDATE、KEEPALIVE、NOTIFICATION

    5. 路由表项由AS内和AS间的路由共同决定

    6. 内部网关协议更关注性能；外部网关协议更关注策略，关注谁在使用网络

8. SDN(Software defined networking)

    1. 逻辑上集中的控制平面

    2. 网络更易管理、基于流表的转发，可编程、控制平面开放实现

    3. OpenFlow协议：控制器和SDN交换机交互的协议

## 第六章 链路层和局域网

1. 数据链路层服务的原理

    1. 检错和纠错

    2. 共享广播信道：多点接入

    3. 链路层寻址

    4. LAN：以太网、WLAN、VLANs

    5. 可靠数据传输，流控制

2. 广域网(WAN)一般点到点连接、局域网(LAN)多点连接

3. 数据链路层负责从一个节点将帧发送到相邻的物理节点

4. 在不同的链路上以不同的链路协议传送，不同的协议提供不同的服务

5. 链路层服务：

    1. 成帧、链路接入
    
    2. 相邻节点完成可靠数据传递(低出错率的链路很少使用)

    3. 流量控制

    4. 错误检测

    5. 差错纠正：检查和纠正bit错误，不重传

    6. 半双工和全双工

6. 链路层功能在“适配器”上实现

7. 错误检测

    1. 奇偶校验

    2. checksum

    3. CRC(循环冗余校验)

8. 多点访问协议(MAC媒体访问控制:介质访问控制协议)

    1. 分类
    
        1. 信道划分：TDMA时分、FDMA频分、CDMA码分
        
        2. 随机访问：如何检测冲突、如何从冲突中恢复
        
            1. 时隙ALOHA：时间被划分为相等的时隙，需要同步时钟，节点可以全速传输
            
            2. ALOHA：无须时间同步，有帧马上传输，冲突概率增加
            
            3. CSMA（载波监听多路访问）：传输前先侦听信道，忙则推迟传送；传播延时可能导致侦听错误，导致冲突
            
            4. CSMA/CD（冲突检测）
            
            5. CSMA/CA
        
        3. 依次轮流

    2. 





